{% extends "base.html" %}

{% block title %}Карточная Игра{% endblock %}

{% block content %}
<div class="container-fluid bg-dark text-white min-vh-100 d-flex flex-column">

    <!-- типа шапка -->
    <div class="py-3 border-bottom">
        <div class="container d-flex justify-content-between align-items-center">
            <h2>Привет, {{ player_name }}!</h2>
            <div>
                <h3>Баланс: ${{ balance | int }}</h3>
                {% if current_bet %}
                    <h4>Ставка: ${{ current_bet }}</h4>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Основной Контент -->
    <div class="flex-grow-1 container my-4">

        <!-- Форма ставки и кнопка начала игры -->
        {% if not cards and not cards_dealer and not result %}
            <div class="row justify-content-center mb-4">
                <div class="col-md-6">
                    <form action="{{ url_for('generate_deck') }}" method="POST" class="d-flex flex-column align-items-center">
                        <div class="mb-3 w-100">
                            <label for="bet" class="form-label">Выберите ставку:</label>
                            <select id="bet" name="bet" class="form-select" required>
                                <option value="2">$2</option>
                                <option value="5">$5</option>
                                <option value="10">$10</option>
                                <option value="all_in">All In (${{ balance }})</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-danger rounded-pill px-4">Начать игру</button>
                    </form>
                </div>
            </div>
        {% endif %}

        <!-- Игровая Зона -->
        {% if cards or dealer_acted %}
            <div class="row">

                <!-- Карты Игрока -->
                <div class="col-md-6 mb-4">
                    <h4>Ваши карты:</h4>
                    <div class="d-flex flex-wrap gap-2">
                        {% for card in cards %}
                            <img src="{{ card.image }}" alt="{{ card.value }} of {{ card.suit }}" class="img-fluid" style="max-width: 100px;">
                        {% endfor %}
                    </div>
                    {% if points is defined %}
                        <p class="mt-2">Ваши баллы: {{ points }}</p>
                    {% endif %}
                </div>

                <!-- Карты Дилера -->
                {% if dealer_acted %}
                    <div class="col-md-6 mb-4">
                        <h4>Карты дилера:</h4>
                        <div class="d-flex flex-wrap gap-2">
                            {% if cards_dealer %}
                                {% for card in cards_dealer %}
                                    <img src="{{ card.image }}" alt="{{ card.value }} of {{ card.suit }}" class="img-fluid" style="max-width: 100px;">
                                {% endfor %}
                            {% else %}
                                <p>Дилер не имеет карт.</p>
                            {% endif %}
                        </div>
                        {% if points_dealer is defined %}
                            <p class="mt-2">Очки дилера: {{ points_dealer }}</p>
                        {% endif %}
                    </div>
                {% endif %}

            </div>


            <!-- Кнопки Управления Игрой -->
            <div class="row justify-content-center mt-5 mb-4">
                <div class="col-md-8 d-flex justify-content-center flex-wrap gap-3">
                    {% if not dealer_acted and not result %}
                        <form action="{{ url_for('draw_card') }}" method="post">
                            <button type="submit" class="btn btn-primary rounded-pill px-4">Вытянуть карту</button>
                        </form>
                        <form action="{{ url_for('dealer') }}" method="get">
                            <button type="submit" class="btn btn-secondary rounded-pill px-4">Передать ход</button>
                        </form>
                    {% endif %}
                    <a href="{{ url_for('final_page') }}" class="btn btn-warning rounded-pill px-4">Закончить игру</a>
                    <button onclick="window.location.href='{{ url_for('reset_game') }}'" class="btn btn-danger rounded-pill px-4" type="button">Сыграть еще раз</button>
                </div>
            </div>
        {% endif %}

        <!-- Результат Игры -->
        {% if result %}
            <div class="row">
                <div class="col">
                    <div class="alert 
                        {% if result == 'win' %}
                            alert-success
                        {% elif result == 'loss' %}
                            alert-danger
                        {% elif result == 'draw' %}
                            alert-warning
                        {% endif %}" 
                        role="alert">
                        {% if result == 'win' %}
                            Поздравляем! Вы выиграли ${{ current_bet * 2 }}!
                        {% elif result == 'loss' %}
                            К сожалению, вы проиграли ${{ current_bet }}.
                        {% elif result == 'draw' %}
                            Ничья! Ваша ставка ${{ current_bet }} возвращена.
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endif %}

    </div>

   

</div>
{% endblock %}